<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>X-ComicReadingList</title>
    <script src="javascripts/angular.js"></script>
    <script src="javascripts/jquery-2.1.1.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="javascripts/xReadingList.js"></script>
    <script src="javascripts/xreadinglist-namelist-factory.js"></script>
    <script src="javascripts/xreadinglist-collection-factory.js"></script>
    <script src="javascripts/xreadinglist-sequence-filter.js"></script>
    <script src="javascripts/xreadinglist-details-controller.js"></script>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="stylesheets/style.css">
</head>
<header>
    <h1 class="heading">X-ReadingList</h1>
    <h2>A tool to help sort through decades of comics.</h2>
    <p>
        Credit for the issue information belongs to the
        <a href="http://www.comics.org/">Grand Comics Database</a>
        and is used according to the
        <a href="http://creativecommons.org/licenses/by/3.0/"> Creative Commons Attribution 3.0 Unported license</a>
    </p>
</header>
<body ng-app="xReadingList"  ng-controller="QueryController as queryCtrl">
    <div class="queryDiv" ng-show="queryCtrl.showQuery">
        <form id="queryForm">
            <h1 class="heading">Search for issues:</h1>
            <div ng-repeat="list in queryCtrl.lists">
                <button type="button" class="btn btn-default btn-block tallButton" data-toggle="button"
                    ng-click="list.selecting = !list.selecting">{{list.title}}
                </button>
                <div class="selectionSummary lightText" ng-hide="list.selecting || list.getDescription().length < 1">
                    <p ng-repeat="line in list.getDescription()">{{line}}</p>
                </div>

                <div class="selectingDiv" ng-show="list.selecting">
                    <div class="searchRow">
                        <label>Search: </label>
                        <input class="darkText" type="text" ng-model="list.searchText">
                        <button class="darkText" ng-click="list.clearSelections()">Clear Selections</button>
                    </div>
                    <table class="listTable">
                        <thead class="selectionHeading">
                            <th class="headingTitle"></th>
                            <th class="headingTitle" ng-show="list.hasAllColumn">All Of</td>
                            <th class="headingTitle">Any Of</td>
                            <th class="headingTitle">Excluding</td>
                        </thead>
                        <tbody>
                            <tr ng-repeat="name in list.names | filter:list.searchText"
                                ng-class-odd="'lightRow'">
                                <td class="nameEntry">{{name}}</td>
                                <td ng-show="list.hasAllColumn">
                                    <button type="button"
                                            class="btn btn-lrg"
                                            ng-class="list.allOf.indexOf(name) >= 0 ? 'btn-success' : 'btn-default'"
                                            ng-click="list.toggleList('All', name)">All of...
                                    </button>
                                </td>
                                <td>
                                    <button type="button"
                                            class="btn btn-lrg"
                                            ng-class="list.anyOf.indexOf(name) >= 0 ? 'btn-success' : 'btn-default'"
                                            ng-click="list.toggleList('Any', name)">Any of...
                                    </button>
                                </td>
                                <td>
                                    <button type="button"
                                            class="btn btn-lrg"
                                            ng-class="list.excluded.indexOf(name) >= 0 ? 'btn-danger' : 'btn-default'"
                                            ng-click="list.toggleList('Exclude', name)">Exclude
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="dateDiv" class="selectingDiv">
                <div class="selectionSummary">
                    <label>From: </label>
                    <input class="darkText" type="number" min="1963" max="2015" ng-model="queryCtrl.startYear">
                    <label>To: </label>
                    <input class="darkText" type="number" min="1963" max="2015" ng-model="queryCtrl.endYear">
                </div>
            </div>

            <button  type="button" class="btn btn-primary btn-block tallButton" ng-click="queryCtrl.query()">Search</button>
        </form>
    </div>

    <div class="queryDiv" ng-hide="queryCtrl.showQuery">
        <h1 class="heading">Found: {{queryCtrl.issues}}</h1>
        <div class="comicDiv" ng-repeat="comic in queryCtrl.collection.comics | orderBy:'name'">
            <p class="seriesHeading">{{comic.name}}</p>
            <div ng-repeat="volume in comic.volumes | orderBy:'name'">
                <label ng-show="volume.name">Volume {{volume.name}}</label>
                <button type="button" class="btn btn-info btn-lrg" data-toggle="button"
                        ng-show="volume.issues.length > 1"
                        ng-click="volume.expand = !volume.expand">{{volume.issues | sequence}}</button>
                <div ng-show="volume.expand || volume.issues.length === 1" ng-controller="DetailsController as detailsCtrl">
                    <button class="btn btn-default" ng-repeat="issue in volume.issues" ng-click="detailsCtrl.getDetails(issue._id)">
                        {{issue.number}}
                    </button>
                    <div class="issueDiv" ng-show="detailsCtrl.showDetails">
                        <div class="infoDiv">
                            <p>{{detailsCtrl.issue.titles.join(", ")}}</p>
                            <p>{{detailsCtrl.issue.month}}, {{detailsCtrl.issue.year}}</p>
                        </div>
                        <div class="creditsDiv">
                            <p>Script: {{detailsCtrl.issue.script.length === 0 ? 'Not available' :
                                detailsCtrl.issue.script.join(", ")}}</p>
                            <p>Pencils: {{detailsCtrl.issue.pencils.length === 0 ? 'Not available' :
                                detailsCtrl.issue.pencils.join(", ")}}</p>
                            <p>Inks: {{detailsCtrl.issue.inks.length === 0 ? 'Not available' :
                                detailsCtrl.issue.inks.join(", ")}}</p>
                            <p>Colours: {{detailsCtrl.issue.colours.length === 0 ? 'Not available' :
                                detailsCtrl.issue.colours.join(", ")}}</p>
                        </div>
                        <div class="synopsisDiv">
                            <p ng-repeat="line in detailsCtrl.issue.synopsis">
                                {{line === "" ? 'No synopsis available' : line}}
                            </p>
                            <p>Characters: {{detailsCtrl.issue.characters.length === 0 ? 'Not available' :
                                detailsCtrl.issue.characters.join(", ")}}</p>
                            <!--<p ng-repeat="item in detailsCtrl.data">{{item}}</p>-->
                            <img href="{{detailsCtrl.img.path}}.{{detailsCtrl.issue.extension}}">
                            <a href="{{detailsCtrl.img.path}}.{{detailsCtrl.issue.extension}}" target="blank">"{{detailsCtrl.img.path}}.{{detailsCtrl.issue.extension}}</a>
                            <a type="button" ng-repeat="url in detailsCtrl.urls" href="{{url.url}}" target="blank">{{url.type}}</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button type="button" class="btn btn-primary btn-block tallButton" ng-click="queryCtrl.hideResults()">New Search</button>
    </div>
</body>
</html>